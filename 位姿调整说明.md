# 位姿调整说明

## 一、坐标系说明

### 1. 相机坐标系（Camera Coordinate System）
- **x轴**：向右（图像宽度方向）
- **y轴**：向下（图像高度方向）
- **z轴**：向前（远离相机，深度方向）

### 2. 物体坐标系（Body/Object Coordinate System）
- **x轴**：向右
- **y轴**：向下
- **z轴**：向前/远离相机

**注意**：物体坐标系和相机坐标系方向一致，位姿（pose）表示从物体坐标系到相机坐标系的变换。

## 二、平移（Translation）说明

平移向量 `t = [tx, ty, tz]` 表示物体中心在相机坐标系中的位置：

- **tx（平移x）**：
  - 正值：物体向右移动
  - 负值：物体向左移动
  - 单位：米（m）

- **ty（平移y）**：
  - 正值：物体向下移动
  - 负值：物体向上移动
  - 单位：米（m）

- **tz（平移z）**：
  - 正值：物体远离相机（向后）
  - 负值：物体靠近相机（向前）
  - 单位：米（m）

### 调整示例

如果立方体框线偏左，需要向右移动：
```bash
--manual_translation_x 0.10  # 向右移动10cm
```

如果立方体框线距离过近，需要向后移动：
```bash
--manual_translation_z 0.60  # 向后移动60cm
```

## 三、旋转（Rotation）说明

旋转表示物体绕坐标轴的旋转角度。

### 旋转方向（右手定则）
- **绕x轴旋转**（在yz平面内旋转）：
  - 正值：逆时针旋转（从x轴正方向看）
  - 负值：顺时针旋转
  - 单位：度（degrees）

- **绕y轴旋转**（在xz平面内旋转）：
  - 正值：逆时针旋转（从y轴正方向看）
  - 负值：顺时针旋转
  - 单位：度（degrees）

- **绕z轴旋转**（在xy平面内旋转）：
  - 正值：逆时针旋转
  - 负值：顺时针旋转
  - 单位：度（degrees）

**注意**：旋转按 x → y → z 的顺序依次应用。

### 调整示例

如果需要绕y轴旋转15度：
```bash
--manual_rotation_y 15  # 绕y轴逆时针旋转15度
```

如果需要绕z轴顺时针旋转30度（在xy平面内）：
```bash
--manual_rotation_z -30  # 绕z轴顺时针旋转30度
```

如果需要同时绕多个轴旋转：
```bash
--manual_rotation_x 10 --manual_rotation_y 15 --manual_rotation_z -30
```

## 四、立方体大小说明

立方体的大小由 `--obj_diameter` 参数控制：

- **参数含义**：物体的直径（对于立方体，等于边长）
- **默认值**：0.056米（56mm，标准3x3魔方）
- **单位**：米（m）

### 立方体顶点定义

立方体以原点为中心，8个顶点定义如下：

```
顶点0: [-half_size, -half_size, -half_size]  # 左下后
顶点1: [ half_size, -half_size, -half_size]  # 右下后
顶点2: [ half_size,  half_size, -half_size]  # 右上后
顶点3: [-half_size,  half_size, -half_size]  # 左上后
顶点4: [-half_size, -half_size,  half_size]  # 左下前
顶点5: [ half_size, -half_size,  half_size]  # 右下前
顶点6: [ half_size,  half_size,  half_size]  # 右上前
顶点7: [-half_size,  half_size,  half_size]  # 左上前
```

其中 `half_size = obj_diameter / 2.0`

### 修改立方体大小

如果您的魔方尺寸不同，可以调整：

```bash
--obj_diameter 0.057  # 57mm的魔方
--obj_diameter 0.060  # 60mm的魔方
```

## 五、完整调整示例

### 示例1：偏左 + 绕y轴旋转15度 + 绕z轴顺时针旋转15度

```bash
conda run -n deepac python -m src_open.tools.estimate_ir_initial_pose \
    --cfg /home/jyj/Projects/DeepAC/src_open/configs/demo/ir_cube_init.yaml \
    --first_frame /media/jyj/JYJ/cube/frames/IR/frame_00000.jpg \
    --obj_diameter 0.056 \
    --bbox_center_x 900 \
    --force_bbox_optimization \
    --manual_translation_x 0.10 \
    --manual_rotation_y 15 \
    --manual_rotation_z -15
```

### 示例2：调整所有参数

```bash
conda run -n deepac python -m src_open.tools.estimate_ir_initial_pose \
    --cfg /home/jyj/Projects/DeepAC/src_open/configs/demo/ir_cube_init.yaml \
    --first_frame /media/jyj/JYJ/cube/frames/IR/frame_00000.jpg \
    --obj_diameter 0.056 \
    --bbox_center_x 900 \
    --force_bbox_optimization \
    --manual_translation_x 0.10 \
    --manual_translation_y 0.00 \
    --manual_translation_z 0.60 \
    --manual_rotation_z -30
```

## 六、调试技巧

1. **先调整平移**：确保位置大致正确
2. **再调整旋转**：微调角度
3. **逐步调整**：每次调整一个参数，观察效果
4. **记录参数**：记录每次调整的值，便于回退

## 七、常见问题

### Q: 如何判断旋转方向？
A: 从相机视角看：
- 顺时针旋转：使用负值（如 `-30`）
- 逆时针旋转：使用正值（如 `30`）

### Q: 平移调整多少合适？
A: 根据图像中的偏差：
- 偏左/右：调整 `translation_x`，每次调整 0.05-0.10m
- 偏上/下：调整 `translation_y`，每次调整 0.05-0.10m
- 距离不准确：调整 `translation_z`，每次调整 0.05-0.10m

### Q: 立方体大小不对怎么办？
A: 测量实际魔方的边长，然后设置 `--obj_diameter` 为实际值（单位：米）

